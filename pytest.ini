# ----------------------------------------------------------
# Author: Nandan Kumar
# Date: 11/09/2025
# Assignment-10: Secure User Model, Pydantic Validation, and Docker Testing
# File: pytest.ini
# ----------------------------------------------------------
# Description:
# Central pytest configuration for running unit and integration tests.
# Excludes E2E + conftest.py from coverage to ensure accurate scoring.
# Enforces â‰¥90% coverage on the actual application code only.
# ----------------------------------------------------------

[pytest]

# ----------------------------------------------------------
# 1. Test Discovery Configuration
# ----------------------------------------------------------
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# ----------------------------------------------------------
# 2. Coverage & Reporting Configuration
# ----------------------------------------------------------
addopts =
    --cov=app
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=90
    -v

# ----------------------------------------------------------
# 3. Coverage Exclusions (important)
# ----------------------------------------------------------
# Exclude fixture-heavy files that do not affect assignment grading.
[coverage:run]
omit =
    tests/conftest.py
    tests/e2e/*
    */__init__.py

# ----------------------------------------------------------
# 4. Custom Markers
# ----------------------------------------------------------
markers =
    fast: marks tests as fast (default)
    slow: marks tests as slow
    e2e: marks end-to-end tests requiring a live server

# ----------------------------------------------------------
# 5. Warning & Logging Configuration
# ----------------------------------------------------------
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

log_cli = true
log_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# ----------------------------------------------------------
# 6. Environment Safety
# ----------------------------------------------------------
env_files = .env
