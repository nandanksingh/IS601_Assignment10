# ----------------------------------------------------------
# Author: Nandan Kumar
# Date: 11/09/2025
# Assignment-10: Secure User Model, Pydantic Validation, and Docker Testing
# File: pytest.ini
# ----------------------------------------------------------
# Description:
# Central pytest configuration for running unit, integration,
# and end-to-end (E2E) tests. Ensures consistent discovery rules,
# ≥90% coverage enforcement, HTML + terminal reports, and clean logging.
# Fully compatible with FastAPI, SQLAlchemy, and Docker-based test setups.
# ----------------------------------------------------------

[pytest]

# ----------------------------------------------------------
# 1. Test Discovery Configuration
# ----------------------------------------------------------
# Automatically detect all test files inside /tests
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# ----------------------------------------------------------
# 2. Coverage & Reporting Configuration
# ----------------------------------------------------------
# Measure coverage on the 'app' package and generate both
# terminal and HTML reports. Enforce ≥90% coverage.
addopts =
    --cov=app
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=90
    -v
    -m "not e2e"

# ----------------------------------------------------------
# 3. Custom Markers (for selective test execution)
# ----------------------------------------------------------
markers =
    fast: marks tests as fast (default)
    slow: marks tests as slow (run only with --run-slow)
    e2e: marks end-to-end tests (requires live FastAPI server)

# ----------------------------------------------------------
# 4. Warning & Logging Configuration
# ----------------------------------------------------------
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

# Enable structured, readable logs during test runs (for CI/CD)
log_cli = true
log_level = INFO
log_cli_format = %(asctime)s [%(levelname)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# ----------------------------------------------------------
# 5. Environment Safety
# ----------------------------------------------------------
# Automatically load .env file if present for consistent local/CI tests
env_files = .env
